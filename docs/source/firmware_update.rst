Firmware update
===============

Using service utility
---------------------

The *fluepboard*'s firmware can be easily updated using a **standalone** binary for GNU/Linux (amd64) that is generated by the *Gitlab CI* build process of this project.

You can get the latest version `here`_.

Make sure your current user has permission to use the serial port (in this example `/dev/ttyUSB0`), then run:

    .. code:: bash

        ./service_utility -serial.port /dev/ttyUSB0

This utility will flash:

* the partition table
* the bootloader
* the factory application


Using esptool.py
----------------

You can also flash the firmware using `esptool.py`_. `Download`_ and unpack the compiled firmware, then run:

    .. code:: bash

        esptool.py --chip esp32 --before=default_reset --after=hard_reset write_flash --flash_mode dio --flash_freq 40m --flash_size 4MB 0x8000 partition_table/partition-table.bin 0x1000 bootloader/bootloader.bin 0x10000 flipdot-firmware.bin

In case the reset circuit on the board does not work and is not able to put the ESP32 into bootloader mode (i.e. because the ESP32 constantly reboots), manually connect the GPIO0 pin to ground to force the bootloader start.

.. _here: https://gitlab.com/fluepke/fluepdot/-/jobs/artifacts/master/raw/software/service_utility/service_utility?job=build_service_utility
.. _esptool.py: https://github.com/espressif/esptool
.. _Download: https://gitlab.com/fluepke/fluepdot/-/jobs/artifacts/master/download?job=build_esp32_image
